# Log Structure (Log Builder)

The **Log Builder** is responsible for creating a standardized and structured log payload before sending it to the Data Nadhi Server.  
It ensures that logs are consistent, traceable, and easily processable ‚Äî regardless of the language or SDK implementation.

---

## üß± Purpose

- Standardize the structure of logs sent from all SDKs.
- Include essential metadata such as timestamps, trace IDs, and source location.
- Maintain separation between **application log format** and **Data Nadhi transmission format** ‚Äî meaning your log formatter can still be fully custom.

---

## üß© Log Payload Schema

A structured log generated by the SDK typically includes the following fields:

| Field | Type | Description |
|-------|------|-------------|
| **message** | `string` | The actual log message generated by the user or application. |
| **trace_id** | `string` | A unique identifier used to trace the flow of a single request or operation across multiple logs. |
| **timestamp** | `string` | UTC timestamp in ISO 8601 format (e.g., `2025-10-23T10:45:00Z`). |
| **log_record** | `object` | Metadata about where and how the log was generated (see below). |
| **context** | `object` | Custom structured data provided by the user ‚Äî useful for adding business or request-specific information. |

---

### üîç `log_record` Object

| Field | Type | Description |
|-------|------|-------------|
| **filename** | `string` | Name of the source file where the log originated. |
| **function_name** | `string` | The function or method name where the log was triggered. |
| **level** | `string` | The severity level of the log (e.g., `INFO`, `DEBUG`, `ERROR`). |
| **line_number** | `number` | Line number in the source file. |
| **module_name** | `string` | The module or component name that produced the log. |

---

## ‚öôÔ∏è Notes

- The SDK automatically collects `log_record` information at runtime.
- The **log payload format is consistent** across all SDKs to maintain compatibility with the Data Nadhi backend.
- The original **application log formatter** can still be different ‚Äî this structure only defines the payload sent to the Data Nadhi Server.
- The **context** field is user-defined and can include nested JSON objects.

---

## üß≠ Example Structure

```json
{
  "message": "User login successful",
  "trace_id": "e5f2a0b9-ff12-4a88-9b61-44c203ef11a7",
  "timestamp": "2025-10-23T10:45:00Z",
  "log_record": {
    "filename": "auth_handler.js",
    "function_name": "loginUser",
    "level": "INFO",
    "line_number": 42,
    "module_name": "auth"
  },
  "context": {
    "user_id": "12345",
    "region": "us-east-1"
  }
}
```

---

---

## üîÅ Trace ID Behavior

The **Trace ID** is a special context variable used to correlate logs from the same execution flow, request, or transaction.  
It ensures that related logs can be grouped and analyzed together ‚Äî even across distributed systems.

### Default Behavior
- If no trace ID exists when a log is created, the SDK automatically **generates a new UUID** as the trace ID.  
- This trace ID remains active for the current execution context and is automatically attached to all subsequent logs.

### Overriding Behavior
- If a **trace ID is provided in the log as keyword arg `trace_id` or as thrid argument to the log**, it **overrides the existing trace ID** for the current execution scope.  
- From that point forward, all new logs use the **new trace ID** automatically, until another override happens or the context resets.

### Context Handling
- In languages that support **context variables**, the SDK stores the trace ID in the current context (thread, coroutine, or request).  
- This ensures **automatic propagation** without requiring developers to manually pass the trace ID every time.

### Why This Matters
- Enables **distributed tracing** across microservices.  
- Simplifies **log correlation** for debugging and performance tracking.  
- Provides a consistent trace chain even across asynchronous or multi-threaded operations.

---

## üß© log_record Details

The `log_record` field holds metadata about where and how a log was generated.  
While the structure is standardized conceptually, the actual implementation **differs slightly between languages** based on what metadata is available from their native logging modules.

### Common Fields
| Field | Type | Description |
|-------|------|-------------|
| **filename** | `string` | The name of the source file where the log originated. |
| **function_name** | `string` | The function or method that emitted the log. |
| **level** | `string` | The severity level (e.g., `DEBUG`, `INFO`, `ERROR`). |
| **line_number** | `number` | Line number of the log statement in the source code. |
| **module_name** | `string` | The logical module or component name. |

### Implementation Notes
- The `log_record` object is **custom-built per SDK**, using the native logging capabilities of that language. But the naming convention will stay the same across all SDKs for a particular field  
- The goal is to include **as much contextual information as possible** ‚Äî without adding unnecessary overhead.  
- Some SDKs may include additional metadata such as:
  - **Thread or process ID**
  - **File path**
  - **Class or package name**
  - **Runtime environment or service name**
- Each SDK maintains the same top-level schema but can extend it for better observability in that ecosystem.

---

## ‚öôÔ∏è Key Notes

- The **log payload** structure remains consistent across SDKs for interoperability.  
- **Application log formatters** are unaffected ‚Äî this structure only defines what‚Äôs sent to the Data Nadhi Server.  
- The **context** field is flexible and can contain any nested JSON structure.  
- **Trace ID propagation** and **log_record customization** together enable both detailed local debugging and global trace correlation.

---

**In short:**  
The Log Builder ensures every log ‚Äî regardless of language or framework ‚Äî carries a complete, structured, and traceable payload, making cross-service observability simple and consistent.
